<% var = params[:category] || 'total' %>
<div class="container-fluid">
  <div class="row">
    <div class="col-sm-12">
      <div class="btn-group">
        <div class="btn-group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
              <%= var.capitalize %> <span class="caret"></span>
            </button>
        <ul class="dropdown-menu" role="menu">
          <li><a href="expenses">Total</a></li>
          <% @expenses.column_names.each do |name| %>
            <% unless ['id', 'year', 'month', 'total'].include?(name) %>
              <li><a href="?category=<%= name %>"><%= name.capitalize %></a></li>
            <% end %>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-9">
      <div id="monthly"></div>
    </div>
    <div class="col-sm-3">
      <div id="total"></div>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-12"></div>
  </div>
</div>
<script>
$(function () {
  $('#monthly').highcharts({
    chart: {
      type: 'column'
    },
    title: {
      text: 'Monthly <%= var.capitalize %> Expenses'
    },
    xAxis: {
      categories: [
        <% @expenses.select(:month).distinct.each do |expense| %>
          '<%= Date::MONTHNAMES[expense.month] %>',
        <% end %>
      ]
    },
    yAxis: {
      title: {
        text: 'Expenses'
      },
      labels: {
        formatter: function() {
          return this.value;
        }
      }
    },
    tooltip: {
      formatter: function() {
        return '<b>'+ this.series.name +'</b><br/>'+
        this.x +': '+ this.y;
      }
    },
    series: [
      <% @years.each do |year| %>
        {
          name: <%= year.year %>,
          data: [
            <% @expenses.year(year.year).each do |expense| %>
              <%= expense[var] %>,
            <% end %>
          ]
      },
      <% end %>
    ]
  });
  $('#total').highcharts({
    chart: {
      type: 'column'
    },
    title: {
      text: 'Annual <%= var.capitalize %> Expenses'
    },
    xAxis: {
      categories: [
        'Annual'
      ]
    },
    yAxis: {
      title: {
        text: 'Expenses'
      },
      labels: {
        formatter: function() {
          return this.value;
        }
      }
    },
    tooltip: {
      formatter: function() {
        return '<b>'+ this.series.name +'</b><br/>'+
        this.x +': '+ this.y;
      }
    },
    series: [
      <% @years.each do |year| %>
        {
          name: <%= year.year %>,
          data: [
            <%= @expenses.year(year.year).sum(var) %>
          ]
      },
      <% end %>
    ]
  });
});
</script>